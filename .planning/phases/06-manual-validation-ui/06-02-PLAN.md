---
phase: 06-manual-validation-ui
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified: [src/ui/views/candidate_selector.py, src/ui/views/main_window.py]
autonomous: true

must_haves:
  truths:
    - "System displays multiple total amount candidates with confidence scores in UI"
    - "User can select correct total amount from candidate list (one-click selection)"
    - "User can validate total amount with keyboard shortcuts (arrow keys, Enter)"
    - "Selected candidate is highlighted in PDF viewer"
  artifacts:
    - path: "src/ui/views/candidate_selector.py"
      provides: "Candidate selector widget with keyboard shortcuts"
      exports: ["CandidateSelector"]
  key_links:
    - from: "src/ui/views/candidate_selector.py"
      to: "src/models/invoice_header.py"
      via: "Displays candidates from InvoiceHeader.total_candidates"
      pattern: "InvoiceHeader|total_candidates"
    - from: "src/ui/views/candidate_selector.py"
      to: "src/ui/views/pdf_viewer.py"
      via: "Signals candidate selection to PDF viewer for highlighting"
      pattern: "PDFViewer|highlight_candidate"
---

<objective>
Create candidate selector widget that displays total amount candidates with confidence scores and supports one-click selection with keyboard shortcuts.

Purpose: Build candidate selector UI component showing top 5 candidates from InvoiceHeader.total_candidates. Support mouse click and keyboard navigation (arrow keys, Enter). Communicate selection to PDF viewer for highlighting.

Output: CandidateSelector widget with selection and keyboard shortcuts.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-manual-validation-ui/06-CONTEXT.md
@src/ui/views/pdf_viewer.py
@src/models/invoice_header.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create candidate selector widget</name>
  <files>src/ui/views/candidate_selector.py</files>
  <action>
Create candidate selector widget `src/ui/views/candidate_selector.py` using PySide6.

**Class to implement:**

`CandidateSelector(QWidget)`:
- Displays list of total amount candidates with confidence scores
- Supports mouse click and keyboard navigation
- Emits signal when candidate selected

**Methods:**
- `set_candidates(candidates: List[Dict]) -> None`: Set candidate list to display
- `keyPressEvent(event: QKeyEvent) -> None`: Handle keyboard shortcuts (arrow keys, Enter)
- `select_candidate(index: int) -> None`: Select candidate by index (programmatic)

**UI Layout:**
- QListWidget or QVBoxLayout with QPushButton for each candidate
- Display format: "SEK {amount} (confidence: {score:.2%})"
- Highlight selected candidate (blue background)
- Show row index and keyword type as tooltip or secondary text

**Signals:**
- `candidate_selected = Signal(int, float)` - Emits (index, amount) when candidate selected

**Keyboard Shortcuts:**
- Up/Down arrow keys: Navigate candidate list
- Enter: Select highlighted candidate
- Escape: Cancel selection (optional)

**Visual Design:**
- Clear, readable list
- Selected candidate highlighted
- Confidence score clearly visible
- Amount formatted as SEK currency

Add type hints and docstrings.
  </action>
  <verify>python -c "from src.ui.views.candidate_selector import CandidateSelector; print('CandidateSelector imported successfully')"</verify>
  <done>CandidateSelector widget created with candidate display, selection, and keyboard shortcuts</done>
</task>

<task type="auto">
  <name>Task 2: Integrate candidate selector with PDF viewer</name>
  <files>src/ui/views/main_window.py</files>
  <action>
Integrate candidate selector with PDF viewer in main window.

**Update MainWindow:**
- Add CandidateSelector widget next to PDF viewer
- Connect signals: candidate_clicked (PDF) → highlight in selector, candidate_selected (Selector) → highlight in PDF
- Synchronize selection between PDF viewer and candidate selector

**UI Layout:**
- Split view: PDF viewer (left/center) + Candidate selector (right)
- Or: PDF viewer (top) + Candidate selector (bottom)
- Ensure both visible when validation mode active

**Signal Connections:**
- PDFViewer.candidate_clicked → CandidateSelector.select_candidate()
- CandidateSelector.candidate_selected → PDFViewer.highlight_candidate()
- Bidirectional synchronization

**State Management:**
- Track selected candidate index
- Update both components when selection changes
- Store selected candidate for correction collection (next plan)

**User Experience:**
- Click on PDF → candidate highlighted in selector
- Click on candidate in selector → highlighted in PDF
- Keyboard navigation works in selector
- Visual feedback clear in both components

Update imports and ensure components work together seamlessly.
  </action>
  <verify>python -c "from src.ui.views.main_window import MainWindow; print('MainWindow integrates CandidateSelector')"</verify>
  <done>Candidate selector integrated with PDF viewer, bidirectional synchronization working</done>
</task>

</tasks>
