---
phase: 12-ui-polish-pyside6
plan: 05
type: execute
wave: 1
depends_on: [12-01]
files_modified: [src/ui/views/ai_settings_dialog.py]
autonomous: true

must_haves:
  truths:
    - "AI settings dialog has grouped sections: Provider, Model, Thresholds, Limits"
    - "Help text is shown under key fields"
    - "Test connection button exists (stub or validation UX if no architecture change)"
    - "Buttons and inputs follow theme"
  artifacts:
    - path: "src/ui/views/ai_settings_dialog.py"
      provides: "Polished AI settings dialog with groups, help, test stub"
  key_links:
    - from: "ai_settings_dialog"
      to: "theme"
      via: "Uses app stylesheet; styled via 12-01"
---

<objective>
Polish the AI settings dialog: grouped settings, help text under key fields, optional Test connection stub, and theme-consistent styling. See 12-DISCUSS.md §5.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/12-ui-polish-pyside6/12-CONTEXT.md
@.planning/phases/12-ui-polish-pyside6/12-DISCUSS.md
@src/ui/views/ai_settings_dialog.py
</context>

<tasks>

<task type="auto">
  <name>Grouped settings: Provider, Model, Thresholds, Limits</name>
  <files>src/ui/views/ai_settings_dialog.py</files>
  <action>
Structure the dialog with QGroupBox or labelled frames:
- **Provider** — AI provider (OpenAI / Claude or dropdown). Existing fields stay; group under one section.
- **Model** — model name/field.
- **Thresholds** — confidence threshold, or other numeric thresholds.
- **Limits** — timeouts, max tokens, or similar limits.

Rearrange existing widgets into these groups so the dialog is scannable. Use QFormLayout or QVBoxLayout inside each group. No new deps.
  </action>
</task>

<task type="auto">
  <name>Help text under key fields</name>
  <files>src/ui/views/ai_settings_dialog.py</files>
  <action>
Add short help text (QLabel with grey/small font or tooltip) under or next to key fields, e.g.:
- Provider: "Välj vilken AI-leverantör som ska användas för totalsumma-extraktion vid låg konfidens."
- Model: "Modellnamn enligt leverantörens API (t.ex. gpt-4o, claude-3-5-sonnet)."
- Threshold: "AI anropas när totalsumma-konfidens är under detta värde (0–1)."

Use setToolTip if that fits better than on-screen text; DISCUSS says "under key fields", so at least 1–2 visible help labels preferred. Style via theme (muted color).
  </action>
</task>

<task type="auto">
  <name>Test connection button (stub or validation UX)</name>
  <files>src/ui/views/ai_settings_dialog.py</files>
  <action>
Add a **"Test connection"** (or "Testa anslutning") button. 12-DISCUSS: "if feasible without architecture changes; otherwise stub with validation UX".

**Stub option:** On click, show a short message: "Kontrollera att API-nyckel är ifylld och att du har nätåtkomst. Faktisk anslutningstest kräver engine/config-anrop." or run a minimal check (e.g. non-empty key + valid-looking format). No HTTP from UI; if we need a real test, it would call into existing config/ai client used by the engine — only do that if it does not add HTTP/service layer. Prefer stub + validation (e.g. "API-nyckel angiven") to keep changes in src/ui/ only.
  </action>
</task>

<task type="auto">
  <name>Buttons and inputs follow theme</name>
  <files>src/ui/views/ai_settings_dialog.py</files>
  <action>
Ensure the dialog and its buttons/inputs do not override the app stylesheet. Use setObjectName for optional QSS targeting (e.g. #aiSettingsDialog). Standard QPushButton, QLineEdit, QComboBox will pick up app_style.qss from 12-01. Remove any hardcoded setStyleSheet or inline styles that conflict with the global theme.
  </action>
  <verify>Open Settings in GUI, confirm groups, help text, Test connection button, and that dialog looks consistent with theme.</verify>
</task>

</tasks>

<success_criteria>
- AI settings dialog has grouped sections, help text, Test connection stub, and theme-consistent look. Changes only in src/ui/views/ai_settings_dialog.py.
</success_criteria>
