---
phase: 12-ui-polish-pyside6
plan: 02
type: execute
wave: 1
depends_on: [12-01]
files_modified: [src/ui/views/main_window.py]
autonomous: true

must_haves:
  truths:
    - "MainWindow has top toolbar with Open PDF, Run, Export, Settings"
    - "Central content uses QSplitter: left PDF viewer, right results/candidate panel"
    - "Status bar shows engine state (Idle/Running/Success/Warning/Error) and last run summary"
    - "Empty state when no PDF: drag&drop + Open CTA"
    - "Shortcuts: Ctrl+O open, Ctrl+R run, Ctrl+E export"
  artifacts:
    - path: "src/ui/views/main_window.py"
      provides: "Professional layout: toolbar, splitter, status bar, empty state, shortcuts"
  key_links:
    - from: "main_window"
      to: "engine_runner"
      via: "Run triggers engine; status bar reflects state"
---

<objective>
Refine MainWindow into a professional layout: toolbar actions, central QSplitter (PDF | results/candidates), status bar with engine state and last-run summary, empty state with drag&drop + Open, and keyboard shortcuts. See 12-DISCUSS.md §2.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/12-ui-polish-pyside6/12-CONTEXT.md
@.planning/phases/12-ui-polish-pyside6/12-DISCUSS.md
@src/ui/views/main_window.py
@src/ui/services/engine_runner.py
</context>

<tasks>

<task type="auto">
  <name>Top toolbar with Open, Run, Export, Settings</name>
  <files>src/ui/views/main_window.py</files>
  <action>
Add or restructure a top QToolBar with actions:
- **Open PDF** (Ctrl+O) — open file dialog, set input path.
- **Run** (Ctrl+R) — start engine run (existing or wired to engine_runner).
- **Export** (Ctrl+E) — export Excel / open output (existing behaviour or placeholder that opens output dir / last Excel).
- **Settings** — open AI settings dialog (existing if present).

Use QAction with shortcuts. Toolbar should be clearly visible; icons optional, text ok. Style via theme (QSS from 12-01).
  </action>
</task>

<task type="auto">
  <name>Central QSplitter: PDF left, results/candidates right</name>
  <files>src/ui/views/main_window.py</files>
  <action>
Make the main content area a horizontal QSplitter:
- **Left:** PDF viewer widget (existing PDFViewer or placeholder).
- **Right:** Results/candidate panel (existing candidate list, validation UI, or summary).

Ensure the splitter is the central widget so users can resize. Set reasonable default sizes (e.g. 50/50 or 60/40). No new dependencies.
  </action>
</task>

<task type="auto">
  <name>Status bar: engine state + last run summary</name>
  <files>src/ui/views/main_window.py</files>
  <action>
Add or use QStatusBar. Show:
- **Engine state:** Idle | Running | Success | Warning | Error (text or small label). Update from engine_runner signals (stateChanged or equivalent once 12-03 is done; until then use started/finished/progress/error).
- **Last run summary:** e.g. "1 file, 1 OK" or "2 files, 1 OK, 1 REVIEW" from last run_summary.json or in-memory result. Can be second permanent message or same line.

Wire to engine_runner.started → "Running", finished(0) → "Success", error → "Error", etc. If 12-03 adds stateChanged, prefer that.
  </action>
</task>

<task type="auto">
  <name>Empty state: drag&drop + Open CTA</name>
  <files>src/ui/views/main_window.py</files>
  <action>
When no PDF is loaded (or no input path set), define clearly):
- Show an empty-state widget in the central area (or over the splitter): short message like "Öppna en PDF för att börja" and a prominent **Open** button (or "Välj PDF").
- Support **drag and drop** of PDF files onto the window (or a drop zone) to set the input and optionally auto-run or just load.

Use setAcceptDrops(True), dragEnterEvent, dropEvent on the window or a central drop placeholder. Keep logic in main_window; no new deps.
  </action>
</task>

<task type="auto">
  <name>Shortcuts Ctrl+O, Ctrl+R, Ctrl+E</name>
  <files>src/ui/views/main_window.py</files>
  <action>
Ensure shortcuts are connected:
- **Ctrl+O** — open file dialog (same as Open PDF).
- **Ctrl+R** — run (same as Run).
- **Ctrl+E** — export / open output (same as Export).

Use QShortcut or QAction.setShortcut. Add to MainWindow or to actions. Verify they work when window has focus.
  </action>
  <verify>Run GUI, press Ctrl+O / Ctrl+R / Ctrl+E and confirm expected behaviour.</verify>
</task>

</tasks>

<success_criteria>
- MainWindow feels like a product: toolbar + splitter + status + empty state. All changes in src/ui/views/main_window.py.
</success_criteria>
