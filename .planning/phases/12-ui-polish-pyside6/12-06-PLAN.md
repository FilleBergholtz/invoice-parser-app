---
phase: 12-ui-polish-pyside6
plan: 06
type: execute
wave: 2
depends_on: [12-01, 12-05]
files_modified:
  - src/ui/views/candidate_selector.py
  - src/ui/views/ai_settings_dialog.py
  - src/ui/views/pdf_viewer.py
  - src/ui/views/main_window.py
  - src/ui/theme/app_style.qss
autonomous: true

must_haves:
  truths:
    - "Candidate buttons have uniform fixed height (52–60px) and readable two-line layout (amount + meta); no excessive vertical growth"
    - "Only one visible 'Settings' entry in UI (no duplicate Settings in toolbar and side menu)"
    - "AI settings: can select an existing provider, edit values, save, and see persisted changes"
    - "Loading a PDF never shows an empty blank viewer; placeholder explains next step and offers Run CTA"
    - "Run is accessible immediately after loading PDF (toolbar + placeholder CTA); enable/disable by engine state (Idle/Running/Done/Error)"
  artifacts:
    - path: "src/ui/views/candidate_selector.py"
      provides: "CandidateButton (checkable) with fixed height, two-line labels, tooltips"
    - path: "src/ui/views/ai_settings_dialog.py"
      provides: "Two-pane AI settings: provider list + detail form, Edit/Save/Cancel, Advanced collapsible"
    - path: "src/ui/views/pdf_viewer.py"
      provides: "Placeholder/overlay when PDF loaded but no pages/results; Run CTA"
    - path: "src/ui/views/main_window.py"
      provides: "Single Settings entry; Run next to Open; Run in placeholder"
  key_links:
    - from: "main_window"
      to: "engine_runner"
      via: "Run enable/disable from engine state (signals if required)"
---

<objective>
Fix remaining UI issues after the polish phase: candidate selector button height, duplicate Settings entry, cluttered AI settings without edit support, PDF viewer blank state, and missing Run button near the Open flow. See Scope/tasks below.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/12-ui-polish-pyside6/12-CONTEXT.md
@.planning/phases/12-ui-polish-pyside6/12-DISCUSS.md
@src/ui/views/candidate_selector.py
@src/ui/views/ai_settings_dialog.py
@src/ui/views/pdf_viewer.py
@src/ui/views/main_window.py
@src/ui/theme/app_style.qss
</context>

<tasks>

<task type="auto">
  <name>Candidate selector: reduce button height, improve text layout</name>
  <files>src/ui/views/candidate_selector.py, src/ui/theme/app_style.qss</files>
  <action>
Replace long-text QPushButton usage with a fixed-height selectable widget:
- **CandidateButton** (checkable): widget containing two QLabel lines — amount + meta.
- Set fixed height (e.g. 52–60px); remove word-wrap that forces growth.
- Add tooltips for full meta when needed; ensure consistent spacing.
Update QSS: remove/avoid min-height and excessive padding for these buttons; style labels via objectName (e.g. candidateAmountLabel, candidateMetaLabel).
  </action>
  <verify>Candidate list has uniform fixed-height items, two-line layout readable; no vertical spill from long text.</verify>
</task>

<task type="auto">
  <name>Remove Settings duplication</name>
  <files>src/ui/views/main_window.py</files>
  <action>
Decide one primary access point:
- Keep **Settings** in top toolbar/menu.
- In side menu: either remove Settings or rename it to **"AI"** (contextual) and route to the same dialog.
Ensure only one **"Settings"** label is visible to the user to avoid redundancy. If "AI" remains in side menu, it opens the same AI/settings dialog as the toolbar Settings.
  </action>
  <verify>Only one visible "Settings" (or one Settings + one "AI" that opens same dialog); no duplicate Settings labels.</verify>
</task>

<task type="auto">
  <name>AI settings dialog: two-pane layout + edit existing provider</name>
  <files>src/ui/views/ai_settings_dialog.py</files>
  <action>
Refactor to two-pane layout:
- **Left:** list of configured providers (OpenAI, Anthropic, …).
- **Right:** detail form bound to the selected provider.

Add Edit/Save/Cancel behavior:
- Selecting an item populates the form fields.
- **Save** updates the existing entry; **Add** creates a new one.
- Mask API key with "Replace" (optional reveal).
Move rarely used fields into an **Advanced** collapsible section.
  </action>
  <verify>Select provider → edit values → Save → changes persist; Add creates new; API key masked; advanced options in collapsible.</verify>
</task>

<task type="auto">
  <name>PDF viewer placeholder / no blank state</name>
  <files>src/ui/views/pdf_viewer.py</files>
  <action>
Add a placeholder/overlay state inside pdf_viewer:
- When PDF is loaded but pages/results are not ready, show:
  **"PDF loaded. Run analysis to display pages/results."** and a **Run** CTA.
Ensure the viewer only shows rendered content when available; never show a plain blank white area.
  </action>
  <verify>After first PDF load, user sees message + Run CTA instead of empty white area.</verify>
</task>

<task type="auto">
  <name>Add Run button near Open flow</name>
  <files>src/ui/views/main_window.py, src/ui/views/pdf_viewer.py, src/ui/services/engine_runner.py</files>
  <action>
- Place **Run** next to **Open** in the main toolbar.
- Place a **Run** CTA in the PDF placeholder/empty-state area (see previous task).
Wire enable/disable rules from engine state: Idle / Running / Done / Error. Use engine_runner signals or state only if required; keep logic in UI where possible.
  </action>
  <verify>Run is visible next to Open; Run in placeholder works; Run disabled during Running, enabled when Idle/Done/Error as appropriate.</verify>
</task>

</tasks>

<success_criteria>
- Candidate buttons: uniform fixed height, two-line layout, no excessive growth.
- Single "Settings" (or Settings + "AI" → same dialog).
- AI settings: select provider, edit, save, persist; API key masked; Advanced section.
- PDF viewer: no blank state; placeholder + Run CTA when loaded but not analysed.
- Run available after PDF load: toolbar + placeholder; enable/disable by engine state.
</success_criteria>
